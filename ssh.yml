---

- name: configure ssh
  hosts: all
  remote_user: root
  tasks:
  - name: add id_rsa.pub to authorized_keys
    authorized_key: user=root key="{{ lookup('file', 'id_rsa.pub') }}"

  - name: Allow root SSH access
    action: lineinfile dest=/etc/ssh/sshd_config regexp="^PermitRootLogin" line="PermitRootLogin yes" state=present
    notify: Restart ssh

  - name: Disallow password authentication
    action: lineinfile dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
    notify: Restart ssh

  handlers:
  - name: Restart ssh
    action: service name=ssh state=restarted
